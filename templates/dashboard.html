<!--
=========================================================
* Argon Dashboard 3 - v2.1.0
=========================================================

* Product Page: https://www.creative-tim.com/product/argon-dashboard
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="{{ url_for('static', filename='img/apple-icon.png') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  <title>
    Argon Dashboard 3 by Creative Tim
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- CSS Files -->
  <link id="pagestyle" href="{{ url_for('static', filename='css/argon-dashboard.css') }}" rel="stylesheet" />
  <link id="pagestyle" href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet" />


</head>

<body class="g-sidenav-show weather-gradient shadow-primary ">
  <div class="min-height-300  shadow-primary  position-absolute w-100"></div>
  
  <main class="main-content position-relative border-radius-lg ">

    <div class="container-fluid py-4">
      <div class="mx-auto mb-4">
        <button type="button" class="btn btn-secondary card-weather-gradient text-white" data-bs-toggle="modal" data-bs-target="#locationModal">
           {{ weather_data.name }} <i class="bi bi-caret-down-fill"></i>
        </button>
      </div>

      <!-- Location Modal -->
      <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header card-weather-gradient">
              <h5 class="modal-title text-white" id="locationModalLabel">Select a Location</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="googleApiKey" value="{{ google_api_key }}">
              <div class="mb-3">
                <input type="text" class="form-control" id="locationSearchInput" placeholder="Search location..." autocomplete="off">
              </div>
              <div id="locationOptions" class="list-group" style="max-height: 300px; overflow-y: auto;">
              </div>
            </div>
            <div class="modal-footer card-weather-gradient">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-success" id="confirmLocation" data-bs-dismiss="modal">Confirm</button>
            </div>
          </div>
        </div>
      </div>
      
      
      <div class="row mt-4">
        <div class="col-8 mb-lg-0 mb-4">
          <div class="card z-index-2 h-100 weather-gradient">
            <div class="card-header pb-0 pt-3 bg-transparent">
              <h6 class="text-capitalize" id="placeholder1Title">Current Weather</h6>
              <p><span class="text-sm" id="localTime"></span></p>
            
                {% if weather_data %}
                  <div class="mt-4">
                    <div class="d-flex align-items-center mb-3">
                      <div class="me-4"> 
                        <img class="img-fluid" src="http://openweathermap.org/img/wn/{{ weather_data.weather[0]['icon'] }}@2x.png" alt="Weather Icon" style="width: 80px; height: 80px;">
                      </div>
                      

                      <div class="row w-100 align-items-center">
                          <div class="col-md-12 d-flex align-items-center">
                              
                              <p class="large-text font-weight-bolder mb-0 me-3">
                                  {{ weather_data.main.temp  |round }}°F
                              </p>

                              <div class="d-flex flex-column">
                                  <p class="text-sm mb-0 opacity-8">
                                      Feels like {{ weather_data.main.feels_like |round }}°
                                  </p>
                                  <p class="text-capitalize text-sm mb-0 font-weight-bold">
                                      {{ weather_data.weather[0].description }}
                                  </p>
                              </div>

                          </div>
                      </div>
                    </div>

                    <p class="text-sm opacity-8 mt-1 ms-4"> The skies: {{ weather_data.weather[0].description }}. The low will be {{ weather_data.main.temp_min  |round }}°F</p>

                    <div class="py-4"></div>
                      <div class="row justify-content-around mt-4">
                        <div class="col-auto ">
                          <div class="square-content">
                            <p class="text-sm"><strong>Wind <i class="bi bi-info-circle icon-small"><br></i></strong> {{ weather_data.wind.speed }} km/h</p>
                          </div>
                        </div>
                        <div class="col-auto ">
                          <div class="square-content">
                            <p class="text-sm"><strong>Humidity <i class="bi bi-info-circle icon-small"><br></i></strong> {{ weather_data.main.humidity }}%</p>
                          </div>
                        </div>
                        <div class="col-auto ">
                          <div class="square-content">
                            <p class="text-sm"><strong>Visibility <i class="bi bi-info-circle icon-small"><br></i></strong> {{ (weather_data.visibility / 1000) }}km</p>
                          </div>
                        </div>
                        <div class="col-auto ">
                          <div class="square-content">
                            <p class="text-sm"><strong>Pressure <i class="bi bi-info-circle icon-small"><br></i></strong> {{ weather_data.main.pressure }} mb</p>
                          </div>
                        </div>
                        <div class="col-auto">
                          <div class="square-content">
                            <p class="text-sm"><strong>Dew Point <i class="bi bi-info-circle icon-small"><br></i></strong> {{ (weather_data.main.temp - ((100 - weather_data.main.humidity) / 5)) |round }} F</p>
                          </div>
                        </div>

                      </div>
                  </div>
                  
            </div>
          </div>
        </div>
        <div class="col-4 mb-lg-0 mb-4">
          <div class="card z-index-2 h-100 weather-gradient">
            <div class="card-body p-0" style="height: 400px">
              <div class="" id="location-map" style="height: 100%; width: 100%;">

              </div>
            </div>
          </div>
        </div>
      </div>

      {% if forecast_data %}
      <h6 class="text-md mt-4 mx-4">Forecast</h6>
      <div class="row mt-3">
        {% for day in forecast_data %}
          {% if loop.first %}
            <div class="col-xl-4 col-md-6 col-sm-12 mb-4 ">
              <div class="card weather-gradient h-100 shadow-sm">
                <div class="card-body p-3">
                  <div class="d-flex align-items-center">
                    <div>
                      <p class="text-sm mb-0 text-uppercase font-weight-bold">TMW - {{ day.day }}</p>
                      <h5 class="font-weight-bolder mb-0">{{ day.temp  |round}}°F</h5>
                      <p class="mb-0 text-sm text-capitalize">{{ day.description }}</p>
                    </div>
                    <div class="ms-auto">
                      <img src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png" class="w-100" style="max-width: 70px;" alt="weather">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <div class="col-xl-2 col-md-4 col-sm-6 col-6 mb-4">
              <div class="card weather-gradient h-100 shadow-sm">
                <div class="card-body p-3 text-center">
                  <p class="text-xs mb-1 text-uppercase font-weight-bold opacity-7">{{ day.day }}</p>
                  <img src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png" style="width: 40px;" alt="icon">
                  <h6 class="font-weight-bolder mb-0">{{ day.temp  |round }}°F</h6>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div> {% endif %}
      {% endif %}
        
      </div>
      
      
      <div class="row mt-1 p-3">
        <div class="col-lg-12 mb-lg-0 mb-4">
          <div class="card weather-gradient">
            <div class="card-body p-3">
              <div class="chart">
                <canvas id="line-chart" class="chart-canvas" style="min-height:300px"></canvas>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    
    </div>
  </main>
  
  </div>
  <!--   Core JS Files   -->
  <script src="{{ url_for('static', filename='js/core/popper.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/core/bootstrap.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/plugins/perfect-scrollbar.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/plugins/smooth-scrollbar.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/plugins/chartjs.min.js') }}"></script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="{{ url_for('static', filename='js/argon-dashboard.min.js') }}"></script>
  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places,marker"></script>

  <script src="{{ url_for('static', filename='js/location-modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <!-- Location Modal Script -->
  <script id="weather-data" type="application/json">
    {{ weather_data | tojson }}
  </script>
    <script id="forecast-json" type="application/json">
    {{ forecast_raw_data | tojson }}
  </script>
  
  <script>

    (function() {
    const forecast = document.getElementById("forecast-json");

    try {
      const forecastData = JSON.parse(forecast.textContent);
      const cur24hr = forecastData.list.slice(0, 8);

      const labels = cur24hr.map(item => {
        const dateObj = new Date(item.dt * 1000);

        return dateObj.getHours() + ":00";
      });

      const temperatures = cur24hr.map(item => Math.round(item.main.temp))
      const icons = cur24hr.map(item => {
            const img = new Image();
            img.src = `https://openweathermap.org/img/wn/${item.weather[0].icon}.png`;
            img.width = 30; // Control size
            img.height = 30;
            return img;
        });

      var ctx = document.getElementById('line-chart').getContext("2d");

      new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: 'Temperature (°C)',
                  data: temperatures,
                  borderColor: '#5e72e4', 
                  backgroundColor: 'rgba(94, 114, 228, 0.1)',
                  fill: true,
                  tension: 0.4, 
                  pointRadius: 15,
                  pointStyle: icons,
                  pointHoverRadius: 20

          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              
              scales: {
                  y: { beginAtZero: false, grid: { display: false } },
                  x: { grid: { display: false } }
              }
            }
      });
    }
    catch(e){
      console.error("chart error", e.message);
    }
   })();

  </script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  

</body>

</html>
